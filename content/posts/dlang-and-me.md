---
title: D言語と私
date: 2017-05-04T01:01:45+09:00
categories:
  - poem
  - technology
tags:
  - dlang
---

眠れないので。

# D言語との出会い
私がD言語と出会ったのはほぼ1年前、高校2年の春だった。
当時部活を辞め、暇をもて余していた私は、[プチコンで動画再生する謎システム](http://www.nicovideo.jp/watch/sm28900081)を作ったりTwitterでの活動をするようになるなど、あり余る時間を使って多くのことを始めていた。
その中で、当時の私にとって最も大きなものは御茶会での活動である。
当時の御茶会では竹輪部というサークル名でゲームの製作をしようという計画が持ち上がっていた。
そして私は、何を考えたのかゲームエンジンを自作しようとしたのだ。


**D言語で。**


扱い始めたばかりの言語でゲームエンジンなどという巨大なプログラムを作成するなどどう考えても無謀である。
そして、設計のセの字も理解していなかった私のプロジェクトは、(大方の予想通り)わずか数週間で頓挫した。
それでも、私はD言語の扱いやすさを深く認識し、D言語erとしての道を進んでいくことになったのだった。


# D言語で言語処理系

smilebasicのPC版処理系として有名なものには[otyaSMILEBASIC](https://github.com/otya128/otyaSMILEBASIC)がある。
しかしソースが全体的に魔界で(パーサが手書きされていたりする)、バグ修正や機能追加をしたくても難しかった。
そこで私は、「ソースの読めるsmilebasic処理系を作ろう」と思いたち、[tosukeSmileBasic](https://github.com/Tosuke/tosukeSmileBasic)を作りはじめた。
パーサには[pegged](https://code.dlang.org/packages/pegged)を使い、ハックしやすく扱いやすい、言うなれば「ぼくの考えたさいきょうのsmilebasic」が完成する。
はずだった。

## 「D言語は仕様はいいけどライブラリに恵まれない」
ところがこのpeggedがかなりの問題児だった。
問題として。
- パーサ内に書けるセマンティックアクションの制限が強い(ParseTreeを返す必要がある)
- 「どの非終端記号でパースされたのか」を示す情報が文字列で渡されるので、Dの型システムの恩恵を受けられない
- パーサコンビネータの生成した中間の木もそのまま渡されるので、それを弾くために処理が煩雑になる

などがある。このため段々パーサを書くのが億劫になり、頓挫してしまった。
ちなみに、私は現在peggedの反省を踏まえてパーサコンビネータを書いている。
これを使えば、tosukeSmileBasicのリベンジができるのではないかと考えている。


眠くなってきたので続きはまた明日。
